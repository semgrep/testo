<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Testo howtos</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="/testo/reference/odoc.support/odoc.css" />
  <link rel="stylesheet" href="/testo/generic.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">Testo howtos</h1>
</header>
<nav id="TOC">
<ul>
<li><a href="#how-to-write-an-assertion-for-a-simple-type-with-alcotest">How to write an assertion for a simple type with Alcotest?</a></li>
<li><a href="#how-to-write-an-assertion-for-a-type-without-alcotest">How to write an assertion for a type without Alcotest?</a></li>
<li><a href="#how-to-write-an-assertion-for-a-custom-type">How to write an assertion for a custom type?</a></li>
<li><a href="#how-to-write-tests-ahead-of-time">How to write tests ahead of time?</a></li>
<li><a href="#how-to-work-on-failed-tests">How to work on failed tests?</a></li>
<li><a href="#how-to-run-only-a-subset-of-a-test-suite">How to run only a subset of a test suite?</a></li>
<li><a href="#how-to-write-tests-for-lwt-async-or-other-kinds-of-promises">How to write tests for Lwt, Async or other kinds of promises?</a></li>
<li><a href="#how-to-check-test-output-against-expected-output">How to check test output against expected output?</a></li>
<li><a href="#how-to-export-test-output-to-junit">How to export test output to JUnit?</a></li>
<li><a href="#how-to-run-tests-in-parallel">How to run tests in parallel?</a></li>
</ul>
</nav>
<h2 id="how-to-write-an-assertion-for-a-simple-type-with-alcotest">How to write an assertion for a simple type with Alcotest?</h2>
<p>To check a result against an expected value and print it in case of an error, Alcotest provides functions that can do this nicely for us for predefined types. For example, <code>Alcotest.int</code> is predefined and is used to check values of type <code>int</code>:</p>
<pre><code>let test_addition =
   Testo.create &quot;addition&quot;
     (fun () -&gt;
       let res = 1 + 1 in
       Alcotest.(check int) &quot;sum&quot; 2 res;
       let res = 2 + 2 in
       Alcotest.(check int) &quot;sum&quot; 4 res
     )</code></pre>
<p><code>Alcotest.int</code> is called a <a href="https://mirage.github.io/alcotest/alcotest/Alcotest/index.html#testable-values">“testable”</a>. There are predefined testables for OCaml’s simple types such as <code>bool</code>, <code>int</code>, <code>string</code>, etc.</p>
<p>Checking a list of strings can be done as follows:</p>
<pre><code>let test_items =
   Testo.create &quot;items&quot;
     (fun () -&gt;
       let res = [&quot;a&quot;] @ [&quot;b&quot;] in
       Alcotest.(check (list string)) &quot;sum&quot; [&quot;a&quot;; &quot;b&quot;] res
     )</code></pre>
<h2 id="how-to-write-an-assertion-for-a-type-without-alcotest">How to write an assertion for a type without Alcotest?</h2>
<p>A simple solution is to use <code>assert</code>:</p>
<pre><code>let test_addition =
  Testo.create &quot;addition&quot;
    (fun () -&gt;
      let res = 1 + 1 in
      assert (res = 2);
      let res = 2 + 2 in
      assert (res = 4);
    )</code></pre>
<p>When such a test fails, the location of the <code>assert ...</code> expression is shown to the user. The advantage over using <code>Alcotest.check</code> is that it’s a little quicker to write. The main disadvantage is that the expected and actual values are not printed. In this case, it’s best for the test to print enough information about the condition being tested e.g.</p>
<pre><code>open Printf

let test_addition =
  Testo.create &quot;addition&quot;
    (fun () -&gt;
      let add a b expected_result =
        let res = a + b in
        printf &quot;checking %i + %i, expecting %i, result is %i.\n&quot;
          a b expected_result res;
        assert (res = expected_result)
      in
      add 1 1 2;
      add 2 2 4;
    )</code></pre>
<p>In case of a failure, the test’s output will be shown to the user.</p>
<h2 id="how-to-write-an-assertion-for-a-custom-type">How to write an assertion for a custom type?</h2>
<p>A testable (see previous section) must be created for types such as records or variants. This is done with <code>Alcotest.testable pp eq</code> where <code>pp</code> is a printer and <code>eq</code> is an equality function.</p>
<p>…</p>
<h2 id="how-to-write-tests-ahead-of-time">How to write tests ahead of time?</h2>
<p>…</p>
<h2 id="how-to-work-on-failed-tests">How to work on failed tests?</h2>
<p>…</p>
<h2 id="how-to-run-only-a-subset-of-a-test-suite">How to run only a subset of a test suite?</h2>
<p>…</p>
<h2 id="how-to-write-tests-for-lwt-async-or-other-kinds-of-promises">How to write tests for Lwt, Async or other kinds of promises?</h2>
<p>…</p>
<h2 id="how-to-check-test-output-against-expected-output">How to check test output against expected output?</h2>
<p>…</p>
<h2 id="how-to-export-test-output-to-junit">How to export test output to JUnit?</h2>
<p>…</p>
<h2 id="how-to-run-tests-in-parallel">How to run tests in parallel?</h2>
<p>…</p>
</body>
</html>
